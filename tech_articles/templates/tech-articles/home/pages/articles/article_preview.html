{% extends "tech-articles/home/base.html" %}
{% load static %}
{% load i18n %}
{% load markdown_filters %}


{% block content %}
  <div class="relative overflow-visible">
    <div class="absolute inset-0 overflow-hidden pointer-events-none rounded-[999px] bg-runbookly-gradient blur-[150px]
                  w-[30vw] h-[130vh] -top-[12vh] -left-[1vw] -rotate-[54.37deg]"></div>

    <section class="relative pt-28 overflow-hidden">

      <section class="article-detail-hero">
        <div class="container-main">

          <!-- Back button -->
          <button class="article-back-btn"
                  onclick="window.history.length > 1 ? window.history.back() : window.location.href='{% url 'content:articles_list' %}'"
                  aria-label="{% trans 'Go back' %}">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10.8008 12L14.7008 15.9C14.8841 16.0834 14.9758 16.3167 14.9758 16.6C14.9758 16.8834 14.8841 17.1167 14.7008 17.3C14.5175 17.4834 14.2841 17.575 14.0008 17.575C13.7175 17.575 13.4841 17.4834 13.3008 17.3L8.7008 12.7C8.6008 12.6 8.53013 12.4917 8.4888 12.375C8.44746 12.2584 8.42646 12.1334 8.4258 12C8.42513 11.8667 8.44613 11.7417 8.4888 11.625C8.53146 11.5084 8.60213 11.4 8.7008 11.3L13.3008 6.70005C13.4841 6.51672 13.7175 6.42505 14.0008 6.42505C14.2841 6.42505 14.5175 6.51672 14.7008 6.70005C14.8841 6.88338 14.9758 7.11672 14.9758 7.40005C14.9758 7.68338 14.8841 7.91672 14.7008 8.10005L10.8008 12Z"
                    fill="currentColor"/>
            </svg>
            {% trans "Back" %}
          </button>

          <div class="article-detail-badge-row">
            {% for category in article.categories.all %}
              <span class="third-featured-article-category">{{ category.name }}</span>
            {% empty %}
              <span class="third-featured-article-category">{% trans "Article" %}</span>
            {% endfor %}
          </div>

          <h1 class="article-detail-title">
            {{ article.title }}
          </h1>

          <p class="article-detail-description">
            {{ article.summary }}
          </p>

          <div class="article-detail-stats">
            <button class="article-stat-btn" aria-label="{% trans 'Clap' %}"
                    data-trigger="subscribe-modal">
              {% include "tech-articles/home/includes/components/__hand_clap_svg.html" %}
              <span class="article-stat-value">{{ clap_count|default:0 }}</span>
            </button>
            <span class="article-stat-separator">|</span>

            {# ── Heart / Like button — opens subscribe modal ── #}
            <button class="article-stat-btn"
                    aria-label="{% trans 'Like' %}"
                    data-trigger="subscribe-modal">
              {% include "tech-articles/home/includes/components/__heart_svg.html" %}
              <span class="article-stat-value">{{ like_count|default:0 }}</span>
            </button>
            <span class="article-stat-separator">|</span>

            {# ── Comment button — opens subscribe modal ── #}
            <button class="article-stat-btn"
                    aria-label="{% trans 'Comments' %}"
                    data-trigger="subscribe-modal">
              {% include "tech-articles/home/includes/components/__comment_svg.html" %}
              <span class="article-stat-value">{{ comment_count|default:0 }}</span>
            </button>
            <span class="article-stat-separator">|</span>

            <span class="article-stat-meta">
            {% blocktrans count minutes=article.reading_time_minutes %}{{ minutes }} min read{% plural %}{{ minutes }}
              min read{% endblocktrans %}
          </span>
            {% if article.published_at %}
              <span class="article-stat-separator">·</span>
              <span class="article-stat-meta">{{ article.published_at|date:"d M Y" }}</span>
            {% endif %}
          </div>

        </div>
      </section>

      {% if article.cover_image %}
        <div class="article-detail-images">
          <div class="container-main">
            <div class="article-detail-images-grid">
              <img src="{{ article.get_cover_image_url }}"
                   alt="{{ article.cover_alt_text|default:article.title }}"
                   class="article-detail-img">
            </div>
          </div>
        </div>
      {% endif %}

    </section>

    <section class="article-preview-section article-paywall-wrapper">
      <div class="container-main">
        <div class="article-preview-layout">

          <div class="article-preview-content-col">
            <div class="article-prose">
              {% if article.preview_content %}
                {{ article.preview_content|markdown_to_html }}
              {% else %}
                {# Fallback: show beginning of first page as preview #}
                {% for page in article.pages.all %}
                  {% if forloop.first %}
                    {{ page.content|markdown_to_plain:500 }}
                  {% endif %}
                {% endfor %}
              {% endif %}
            </div>
          </div>

          <aside class="article-preview-sidebar">

            <div>
              {% if toc %}
                <div class="mb-8">
                  <h3 class="articles-listing-section-title">{% trans "Table of Contents" %}</h3>
                  <nav class="toc-nav">
                    {% include "tech-articles/home/includes/components/_toc.html" with items=toc %}
                  </nav>
                </div>
              {% endif %}

              <h3 class="articles-listing-section-title">{% trans "Related articles" %}</h3>
              <div class="related-articles-list pointer-events-none relative">

                {% include "tech-articles/home/includes/components/_related_article_card.html" with category="Frontend" read_time=5 title="Building scalable frontend architecture" description="Design systems, shared patterns, and clear ownership models for large products." link="#" %}

                {% include "tech-articles/home/includes/components/_related_article_card.html" with category="DevOps" read_time=4 title="Automating deployment with GitHub Actions" description="A practical guide to pipeline stages, approvals, and safe release strategies." link="#" %}

                <!-- Background decorative element -->
                <div
                  class="absolute pointer-events-none rounded-[999px] bg-runbookly-gradient blur-[150px]
                         w-[20vw] h-[120vh]
                         top-[20%] z-5 -right-[3vw] rotate-[54.37deg]"
                  aria-hidden="true"
                ></div>

                {% include "tech-articles/home/includes/components/_related_article_card.html" with category="JavaScript" read_time=6 title="Clean code principles with JavaScript" description="How to keep JS codebases readable and maintainable with real-world examples." link="#" %}

                {% include "tech-articles/home/includes/components/_related_article_card.html" with category="Performance" read_time=7 title="Advanced caching strategies with Redis" description="Cache-aside, write-through, and invalidation techniques for modern apps." link="#" %}

              </div>
            </div>

          </aside>
        </div>
      </div>
      <div class="article-paywall-overlay"
           aria-label="{% trans 'Premium content — subscription required' %}">

        <div class="article-paywall-card">

          <h2 class="article-paywall-title">
            {% trans "Unlock the full article" %}
          </h2>

          <p class="article-paywall-subtitle">
            {% trans "Get full access to in-depth technical content written from real-world experience, not tutorials copied from documentation." %}
          </p>

          <h3 class="article-paywall-cta-label">
            {% trans "Get full access" %}
          </h3>

          <a href="{% url 'common:home' %}#pricing" class="btn-primary article-paywall-btn">
            {% trans "See subscription plans" %}
          </a>
        </div>
      </div>
    </section>

    {# ── Subscribe / Comment Modal ──────────────────────────────────────────── #}
    {% include "tech-articles/home/includes/components/_subscribe_comment_modal.html" %}
  </div>
{% endblock %}


{% block js %}
  {# Flowbite v3 must be loaded before this script (already in base.html) #}
  <script src="{% static 'js/home/articles/subscribe_comment_modal.js' %}" defer></script>
{% endblock %}

