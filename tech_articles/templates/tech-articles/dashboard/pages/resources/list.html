{% extends 'tech-articles/dashboard/pages/_page_base.html' %}
{% load i18n %}
{% load resource_filters %}

{% block page_title %}{% translate 'All Resources' %}{% endblock %}

{% block page_content %}
  {% csrf_token %}
  <div class="space-y-6">
    <!-- Page Header -->
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold text-white mb-1">{% translate "Resource Documents" %}</h1>
        <p class="text-text-secondary text-sm">{% translate "Manage uploaded documents and resources" %}</p>
      </div>
      <a href="{% url 'resources:resources_create' %}"
         class="btn-primary">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        {% translate "Upload Resource" %}
      </a>
    </div>

    <!-- Filters -->
    <div class="bg-surface-dark rounded-xl border border-border-dark p-4">
      <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <!-- Search -->
        <div class="md:col-span-2">
          <input type="text"
                 name="search"
                 value="{{ search }}"
                 placeholder="{% translate 'Search resources...' %}"
                 class="dashboard-input w-full">
        </div>

        <!-- Access Level Filter -->
        <div>
          <select name="access_level" class="dashboard-select w-full">
            <option value="">{% translate "All Access Levels" %}</option>
            <option value="free" {% if access_level == 'free' %}selected{% endif %}>{% translate "Free" %}</option>
            <option value="premium"
                    {% if access_level == 'premium' %}selected{% endif %}>{% translate "Premium" %}</option>
            <option value="purchase_required"
                    {% if access_level == 'purchase_required' %}selected{% endif %}>{% translate "Purchase Required" %}</option>
          </select>
        </div>

        <!-- Search Button -->
        <div class="flex gap-2">
          <button type="submit" class="btn-primary flex-1">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            {% translate "Search" %}
          </button>
          {% if search or access_level %}
            <a href="{% url 'resources:resources_list' %}" class="btn-secondary">
              {% translate "Clear" %}
            </a>
          {% endif %}
        </div>
      </form>
    </div>

    <!-- Resources Grid -->
    {% if resources %}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for resource in resources %}
          <div
            class="bg-surface-dark rounded-xl border border-border-dark p-5 hover:border-primary/30 transition-colors flex flex-col">
            <!-- Header with Icon -->
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-start gap-3">
                <!-- File Icon -->
                <div class="shrink-0">
                  {% with filename=resource.file_name.lower %}
                    {% if '.pdf' in filename %}
                      <svg class="w-10 h-10 text-red-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2 2 2 0 0 0 2 2h12a2 2 0 0 0 2-2 2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2V4a2 2 0 0 0-2-2h-7Zm-6 9a1 1 0 0 0-1 1v5a1 1 0 1 0 2 0v-1h.5a2.5 2.5 0 0 0 0-5H5Zm1.5 3H6v-1h.5a.5.5 0 0 1 0 1Zm4.5-3a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h1.376A2.626 2.626 0 0 0 15 15.375v-1.75A2.626 2.626 0 0 0 12.375 11H11Zm1 5v-3h.375a.626.626 0 0 1 .625.626v1.748a.625.625 0 0 1-.626.626H12Zm5-5a1 1 0 0 0-1 1v5a1 1 0 1 0 2 0v-1h1a1 1 0 1 0 0-2h-1v-1h1a1 1 0 1 0 0-2h-2Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.doc' in filename or '.docx' in filename %}
                      <svg class="w-10 h-10 text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 7V2.221a2 2 0 0 0-.5.365L4.586 6.5a2 2 0 0 0-.365.5H9Zm2 0V2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9h5a2 2 0 0 0 2-2Zm-1.02 4.804a1 1 0 1 0-1.96.392l1 5a1 1 0 0 0 1.838.319L12 15.61l1.143 1.905a1 1 0 0 0 1.838-.319l1-5a1 1 0 0 0-1.962-.392l-.492 2.463-.67-1.115a1 1 0 0 0-1.714 0l-.67 1.116-.492-2.464Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.xls' in filename or '.xlsx' in filename %}
                      <svg class="w-10 h-10 text-green-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 7V2.221a2 2 0 0 0-.5.365L4.586 6.5a2 2 0 0 0-.365.5H9Zm2 0V2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9h5a2 2 0 0 0 2-2Zm2-2a1 1 0 1 0 0 2h3a1 1 0 1 0 0-2h-3Zm0 3a1 1 0 1 0 0 2h3a1 1 0 1 0 0-2h-3Zm-6 4a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1v-6Zm8 1v1h-2v-1h2Zm0 3h-2v1h2v-1Zm-4-3v1H9v-1h2Zm0 3H9v1h2v-1Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.csv' in filename %}
                      <svg class="w-10 h-10 text-green-600" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2 2 2 0 0 0 2 2h12a2 2 0 0 0 2-2 2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2V4a2 2 0 0 0-2-2h-7Zm1.018 8.828a2.34 2.34 0 0 0-2.373 2.13v.008a2.32 2.32 0 0 0 2.06 2.497l.535.059a.993.993 0 0 0 .136.006.272.272 0 0 1 .263.367l-.008.02a.377.377 0 0 1-.018.044.49.49 0 0 1-.078.02 1.689 1.689 0 0 1-.297.021h-1.13a1 1 0 1 0 0 2h1.13c.417 0 .892-.05 1.324-.279.47-.248.78-.648.953-1.134a2.272 2.272 0 0 0-2.115-3.06l-.478-.052a.32.32 0 0 1-.285-.341.34.34 0 0 1 .344-.306l.94.02a1 1 0 1 0 .043-2l-.943-.02h-.003Zm7.933 1.482a1 1 0 1 0-1.902-.62l-.57 1.747-.522-1.726a1 1 0 0 0-1.914.578l1.443 4.773a1 1 0 0 0 1.908.021l1.557-4.773Zm-13.762.88a.647.647 0 0 1 .458-.19h1.018a1 1 0 1 0 0-2H6.647A2.647 2.647 0 0 0 4 13.647v1.706A2.647 2.647 0 0 0 6.647 18h1.018a1 1 0 1 0 0-2H6.647A.647.647 0 0 1 6 15.353v-1.706c0-.172.068-.336.19-.457Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.ppt' in filename or '.pptx' in filename %}
                      <svg class="w-10 h-10 text-orange-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2 2 2 0 0 0 2 2h12a2 2 0 0 0 2-2 2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2V4a2 2 0 0 0-2-2h-7Zm-6 9a1 1 0 0 0-1 1v5a1 1 0 1 0 2 0v-1h.5a2.5 2.5 0 0 0 0-5H5Zm1.5 3H6v-1h.5a.5.5 0 0 1 0 1Zm4.5-3a1 1 0 0 0-1 1v5a1 1 0 1 0 2 0v-1h.5a2.5 2.5 0 0 0 0-5H11Zm1.5 3H12v-1h.5a.5.5 0 0 1 0 1Zm4.5-3a1 1 0 1 0 0 2v4a1 1 0 1 0 2 0v-4a1 1 0 1 0 0-2h-2Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.png' in filename or '.jpg' in filename or '.jpeg' in filename or '.gif' in filename or '.svg' in filename or '.webp' in filename %}
                      <svg class="w-10 h-10 text-purple-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-7Zm.394 9.553a1 1 0 0 0-1.817.062l-2.5 6A1 1 0 0 0 8 19h8a1 1 0 0 0 .894-1.447l-2-4A1 1 0 0 0 13.2 13.4l-.53.706-1.276-2.553ZM13 9.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.mp3' in filename or '.wav' in filename or '.ogg' in filename or '.flac' in filename %}
                      <svg class="w-10 h-10 text-pink-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 7V2.221a2 2 0 0 0-.5.365L4.586 6.5a2 2 0 0 0-.365.5H9Zm2 0V2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9h5a2 2 0 0 0 2-2Zm2.318.052h-.002A1 1 0 0 0 12 8v5.293A4.033 4.033 0 0 0 10.5 13C8.787 13 7 14.146 7 16s1.787 3 3.5 3 3.5-1.146 3.5-3c0-.107-.006-.211-.017-.313A1.04 1.04 0 0 0 14 15.5V9.766c.538.493 1 1.204 1 2.234a1 1 0 1 0 2 0c0-1.881-.956-3.14-1.86-3.893a6.4 6.4 0 0 0-1.636-.985 4.009 4.009 0 0 0-.165-.063l-.014-.005-.005-.001-.002-.001ZM9 16c0-.356.452-1 1.5-1s1.5.644 1.5 1-.452 1-1.5 1S9 16.356 9 16Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.mp4' in filename or '.mov' in filename or '.avi' in filename or '.mkv' in filename %}
                      <svg class="w-10 h-10 text-indigo-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 7V2.221a2 2 0 0 0-.5.365L4.586 6.5a2 2 0 0 0-.365.5H9Zm2 0V2h7a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9h5a2 2 0 0 0 2-2Zm-2 4a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2v-2a2 2 0 0 0-2-2H9Zm0 2h2v2H9v-2Zm7.965-.557a1 1 0 0 0-1.692-.72l-1.268 1.218a1 1 0 0 0-.308.721v.733a1 1 0 0 0 .37.776l1.267 1.032a1 1 0 0 0 1.631-.776v-2.984Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.zip' in filename or '.rar' in filename or '.7z' in filename or '.tar' in filename or '.gz' in filename %}
                      <svg class="w-10 h-10 text-yellow-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-7Zm3 2h2.01v2.01h-2V8h2v2.01h-2V12h2v2.01h-2V16h2v2.01h-2v2H12V18h2v-1.99h-2V14h2v-1.99h-2V10h2V8.01h-2V6h2V4Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.txt' in filename %}
                      <svg class="w-10 h-10 text-gray-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-7ZM8 16a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Zm1-5a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2H9Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% elif '.odt' in filename %}
                      <svg class="w-10 h-10 text-blue-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path
                          d="M6 16v-3h.375a.626.626 0 0 1 .625.626v1.749a.626.626 0 0 1-.626.625H6Zm6-2.5a.5.5 0 1 1 1 0v2a.5.5 0 0 1-1 0v-2Z"></path>
                        <path fill-rule="evenodd"
                              d="M11 7V2h7a2 2 0 0 1 2 2v5h1a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1h-1a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2H3a1 1 0 0 1-1-1v-9a1 1 0 0 1 1-1h6a2 2 0 0 0 2-2Zm7.683 6.006 1.335-.024-.037-2-1.327.024a2.647 2.647 0 0 0-2.636 2.647v1.706a2.647 2.647 0 0 0 2.647 2.647H20v-2h-1.335a.647.647 0 0 1-.647-.647v-1.706a.647.647 0 0 1 .647-.647h.018ZM5 11a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h1.376A2.626 2.626 0 0 0 9 15.375v-1.75A2.626 2.626 0 0 0 6.375 11H5Zm7.5 0a2.5 2.5 0 0 0-2.5 2.5v2a2.5 2.5 0 0 0 5 0v-2a2.5 2.5 0 0 0-2.5-2.5Z"
                              clip-rule="evenodd"></path>
                        <path d="M9 7V2.221a2 2 0 0 0-.5.365L4.586 6.5a2 2 0 0 0-.365.5H9Z"></path>
                      </svg>
                    {% else %}
                      <svg class="w-10 h-10 text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                           fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd"
                              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-7Z"
                              clip-rule="evenodd"></path>
                      </svg>
                    {% endif %}
                  {% endwith %}
                </div>

                <div class="flex-1 min-w-0">
                  <h3 class="text-white font-semibold text-sm mb-1" title="{{ resource.title|truncatechars:30 }}">
                    {{ resource.title }}
                  </h3>
                  <p class="text-text-secondary text-xs">{{ resource.file_size|filesize }}</p>
                </div>
              </div>

              <!-- Status Badge -->
              <span class="items-center px-2 py-1 rounded text-xs inline-block font-medium whitespace-nowrap truncate
                     {% if resource.access_level == 'free' %}bg-green-500/10 text-green-400
                     {% elif resource.access_level == 'premium' %}bg-primary/10 text-primary
                     {% else %}bg-yellow-500/10 text-yellow-400{% endif %}">
          {{ resource.get_access_level_display }}
        </span>
            </div>

            <!-- Description -->
            {% if resource.description %}
              <p class="text-text-secondary text-sm mb-4 line-clamp-2">
                {{ resource.description }}
              </p>
            {% endif %}

            <!-- Meta Info -->
            <div class="flex items-center gap-4 mb-4 text-xs text-text-muted mt-auto">
              {% if resource.article %}
                <div class="flex items-center gap-1">
                  <svg
                    class="size-4 -translate-y-0.5"
                    width="24"
                    height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                      d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z"
                      stroke="currentColor" stroke-width="2" fill="none"></path>
                    <path d="M7 7H17M7 12H17M7 17H13" stroke="currentColor" stroke-width="2"
                          stroke-linecap="round" fill="none"></path>
                  </svg>
                  <span class="truncate">{{ resource.article.title }}</span>
                </div>
              {% endif %}

              <div class="flex items-center gap-1">
                <svg class="w-4 h-4 -translate-y-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                </svg>
                <span>{{ resource.download_count }}</span>
              </div>
            </div>

            <!-- Actions -->
            <div class="flex items-center gap-2 pt-4 border-t border-border-dark">
              <a href="{% url 'resources:resources_update' resource.pk %}"
                 class="flex-1 btn-secondary text-xs py-2">
                {% translate "Edit" %}
              </a>
              <a href="{% url 'resources:resources_download_url' resource.pk %}"
                 class="flex-1 btn-primary text-xs py-2"
                 target="_blank">
                {% translate "Download" %}
              </a>
              <button type="button"
                      onclick="deleteResource('{{ resource.pk }}')"
                      class="px-3 py-2 text-red-400 hover:bg-red-500/10 rounded-lg transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
              </button>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if is_paginated %}
        <div class="flex items-center justify-center gap-2 mt-8">
          {% if page_obj.has_previous %}
            <a href="?page=



              {{ page_obj.previous_page_number }}{% if search %}&search={{ search }}{% endif %}{% if access_level %}&access_level={{ access_level }}{% endif %}"
               class="px-4 py-2 bg-surface-light border border-border-dark rounded-lg text-white hover:border-primary transition-colors">
              {% translate "Previous" %}
            </a>
          {% endif %}

          <span class="px-4 py-2 text-text-secondary">
      {% translate "Page" %} {{ page_obj.number }} {% translate "of" %} {{ page_obj.paginator.num_pages }}
    </span>

          {% if page_obj.has_next %}
            <a href="?page=



              {{ page_obj.next_page_number }}{% if search %}&search={{ search }}{% endif %}{% if access_level %}&access_level={{ access_level }}{% endif %}"
               class="px-4 py-2 bg-surface-light border border-border-dark rounded-lg text-white hover:border-primary transition-colors">
              {% translate "Next" %}
            </a>
          {% endif %}
        </div>
      {% endif %}

    {% else %}
      <!-- Empty State -->
      <div class="bg-surface-dark rounded-xl border border-border-dark p-12 text-center">
        <svg class="mx-auto h-16 w-16 text-text-muted mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
        </svg>
        <h3 class="text-lg font-semibold text-white mb-2">{% translate "No resources found" %}</h3>
        <p class="text-text-secondary mb-6">
          {% if search or access_level %}
            {% translate "Try adjusting your filters" %}
          {% else %}
            {% translate "Upload your first resource document to get started" %}
          {% endif %}
        </p>
        {% if not search and not access_level %}
          <a href="{% url 'resources:resources_create' %}" class="btn-primary">
            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
            </svg>
            {% translate "Upload Resource" %}
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="hidden fixed inset-0 bg-black/50 z-10000001 flex items-center justify-center">
    <div class="bg-surface-dark rounded-xl border border-border-dark p-6 max-w-md w-full mx-4">
      <h3 class="text-lg font-semibold text-white mb-2">{% translate "Delete Resource" %}</h3>
      <p
        class="text-text-secondary mb-6">{% translate "Are you sure you want to delete this resource? This action cannot be undone." %}</p>

      <div class="flex items-center justify-end gap-3">
        <button type="button" onclick="closeDeleteModal()" class="btn-secondary">
          {% translate "Cancel" %}
        </button>
        <button type="button" id="confirm-delete-btn" class="btn-danger">
          {% translate "Delete" %}
        </button>
      </div>
    </div>
  </div>
{% endblock %}

{% block js %}
  <script>
    window.resourceUrls = {
      delete: (id) => `{% url 'resources:resources_delete' '00000000-0000-0000-0000-000000000000' %}`.replace("00000000-0000-0000-0000-000000000000", id)
    };

    let deleteResourceId = null;

    function deleteResource(resourceId) {
      deleteResourceId = resourceId;
      document.getElementById('delete-modal').classList.remove('hidden');
    }

    function closeDeleteModal() {
      document.getElementById('delete-modal').classList.add('hidden');
      deleteResourceId = null;
    }

    document.getElementById('confirm-delete-btn').addEventListener('click', async function () {
      if (!deleteResourceId) return;

      window.loader?.show();

      try {
        const response = await fetch(window.resourceUrls.delete(deleteResourceId), {
          method: 'POST',
          headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'X-Requested-With': 'XMLHttpRequest',
          },
        });

        if (response.ok) {
          window.location.reload();
        } else {
          throw new Error('Delete failed');
        }
      } catch (error) {
        if (window.toastManager) {
          window.toastManager.buildToast()
            .setMessage(gettext('Failed to delete resource'))
            .setType('danger')
            .show();
        }
      } finally {
        window.loader?.hide();
        closeDeleteModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', function (e) {
      if (e.key === 'Escape') {
        closeDeleteModal();
      }
    });
  </script>
{% endblock %}


