{% extends 'tech-articles/dashboard/pages/_page_base.html' %}
{% load i18n %}

{% block page_title %}{% translate 'Appointment Services' %}{% endblock %}

{% block page_subtitle %}
  <p class="text-text-secondary mt-1">{% translate 'Define different types of services, pricing, and durations.' %}</p>
{% endblock %}

{% block page_content %}
  <div class="space-y-6">
    <div class="flex items-center justify-between p-4 bg-surface-darker border border-border rounded-xl">
      <h3 class="font-semibold text-white">{% translate 'Service Catalog' %}</h3>
      <a href="{% url 'appointments:appointment_types_create' %}" class="btn btn-primary flex items-center gap-2 px-4 py-2 hover:scale-[1.02] transition-transform">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        {% translate 'Add Service' %}
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {% for type in appointment_types %}
        <div class="group bg-surface-darker border border-border hover:border-primary/40 rounded-2xl overflow-hidden transition-all duration-300 shadow-lg hover:shadow-primary/5">
          <div class="p-6 space-y-5">
            <div class="flex items-start justify-between">
              <div class="space-y-1">
                <h4 class="text-xl font-bold text-white group-hover:text-primary transition-colors">{{ type.name }}</h4>
                <div class="flex items-center gap-2">
                   <span class="text-[10px] font-bold uppercase tracking-widest text-text-secondary">#{{ type.id|stringformat:".8s" }}</span>
                </div>
              </div>
              <div class="flex flex-col items-end gap-2">
                {% if type.is_active %}
                  <span class="flex items-center gap-1.5 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider text-success bg-success/10 border border-success/20 rounded-full">
                    <span class="w-1.5 h-1.5 rounded-full bg-success"></span>
                    {% translate 'Active' %}
                  </span>
                {% else %}
                  <span class="flex items-center gap-1.5 px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider text-text-secondary bg-white/5 border border-white/10 rounded-full">
                    <span class="w-1.5 h-1.5 rounded-full bg-text-secondary"></span>
                    {% translate 'Inactive' %}
                  </span>
                {% endif %}
              </div>
            </div>

            <p class="text-sm text-text-secondary leading-relaxed line-clamp-2 min-h-[2.5rem]">{{ type.description|default:"No description provided." }}</p>

            <div class="grid grid-cols-2 gap-4 py-4 border-y border-white/5">
              <div class="space-y-0.5">
                <p class="text-[10px] font-black uppercase tracking-widest text-text-secondary opacity-60">{% translate 'Base Rate' %}</p>
                <p class="text-lg font-bold text-white">{{ type.base_hourly_rate }} <span class="text-xs font-medium text-text-secondary">{{ type.currency }}</span></p>
              </div>
              <div class="space-y-0.5 text-right">
                <p class="text-[10px] font-black uppercase tracking-widest text-text-secondary opacity-60">{% translate 'Duration' %}</p>
                <div class="flex flex-wrap justify-end gap-1 mt-0.5">
                  {% for duration in type.allowed_durations_minutes.split %}
                    <span class="text-[10px] px-1.5 py-0.5 bg-white/5 border border-white/10 rounded font-mono text-white">{{ duration }}m</span>
                  {% endfor %}
                </div>
              </div>
            </div>

            <div class="flex items-center justify-between pt-2">
              <div class="flex items-center gap-1 text-[10px] text-text-secondary">
                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span>{% translate 'Last updated' %} {{ type.updated_at|date:"M d" }}</span>
              </div>
              <div class="flex items-center gap-2">
                <a href="{% url 'appointments:appointment_types_update' type.pk %}" class="p-2 text-text-secondary hover:text-white hover:bg-white/5 rounded-lg transition-all" title="{% translate 'Edit' %}">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
                </a>
                <button type="button" 
                        data-delete-action 
                        data-item-id="{{ type.id }}" 
                        data-item-name="{{ type.name }}" 
                        data-delete-url="{% url 'appointments:appointment_types_delete' type.pk %}"
                        data-modal-target="delete-modal"
                        class="p-2 text-danger/60 hover:text-danger hover:bg-danger/10 rounded-lg transition-all" 
                        title="{% translate 'Delete' %}">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-span-full py-20 text-center bg-surface-darker/50 rounded-2xl border border-dashed border-border flex flex-col items-center justify-center space-y-4">
          <div class="w-16 h-16 bg-white/5 flex items-center justify-center rounded-full text-text-secondary">
             <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
          </div>
          <p class="text-text-secondary italic text-lg">{% translate 'No appointment services have been configured yet.' %}</p>
          <a href="{% url 'appointments:appointment_types_create' %}" class="btn btn-primary px-6">{% translate 'Get Started' %}</a>
        </div>
      {% endfor %}
    </div>
  </div>

  {% include "tech-articles/dashboard/includes/_delete_modal.html" %}
{% endblock %}

{% block js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Show delete modal on click
        document.querySelectorAll('[data-delete-action]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modal = document.getElementById('delete-modal');
                const nameDisplay = modal.querySelector('[data-delete-item-name]');
                const form = modal.querySelector('form');
                
                nameDisplay.textContent = `"${btn.dataset.itemName}"`;
                form.action = btn.dataset.deleteUrl;
                modal.classList.remove('hidden');
            });
        });
    });
</script>
{% endblock %}
