{% extends 'tech-articles/dashboard/pages/_page_base.html' %}
{% load i18n static %}

{% block page_title %}{% translate 'Media Library' %}{% endblock %}

{% block page_subtitle %}
<p class="text-text-secondary mt-2">{% translate 'Manage your images, videos, and documents' %}</p>
{% endblock %}

{% block page_content %}
<!-- Header Actions -->
<div class="flex flex-wrap gap-4 mb-6">
  <a href="{% url 'dashboard:media:upload' %}" class="btn btn-primary">
    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
    </svg>
    {% translate 'Upload Files' %}
  </a>
  
  <a href="{% url 'dashboard:media:folders' %}" class="btn btn-secondary">
    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
    </svg>
    {% translate 'Manage Folders' %}
  </a>
</div>

<!-- Search and Filters -->
<div class="bg-bg-secondary rounded-lg p-4 mb-6">
  <form method="get" class="flex flex-wrap gap-4">
    <div class="flex-1 min-w-[200px]">
      <input 
        type="text" 
        name="q" 
        value="{{ search_query }}" 
        placeholder="{% translate 'Search files...' %}"
        class="w-full px-4 py-2 rounded-lg border border-border bg-bg-primary text-text-primary focus:ring-2 focus:ring-primary focus:border-transparent"
      >
    </div>
    
    <div class="min-w-[150px]">
      <select name="type" class="w-full px-4 py-2 rounded-lg border border-border bg-bg-primary text-text-primary focus:ring-2 focus:ring-primary">
        <option value="">{% translate 'All Types' %}</option>
        <option value="image" {% if current_type == 'image' %}selected{% endif %}>{% translate 'Images' %}</option>
        <option value="video" {% if current_type == 'video' %}selected{% endif %}>{% translate 'Videos' %}</option>
        <option value="document" {% if current_type == 'document' %}selected{% endif %}>{% translate 'Documents' %}</option>
        <option value="audio" {% if current_type == 'audio' %}selected{% endif %}>{% translate 'Audio' %}</option>
      </select>
    </div>
    
    <div class="min-w-[150px]">
      <select name="folder" class="w-full px-4 py-2 rounded-lg border border-border bg-bg-primary text-text-primary focus:ring-2 focus:ring-primary">
        <option value="">{% translate 'All Folders' %}</option>
        {% for folder in folders %}
        <option value="{{ folder.id }}" {% if current_folder == folder.id|stringformat:"s" %}selected{% endif %}>
          {{ folder.name }}
        </option>
        {% endfor %}
      </select>
    </div>
    
    <button type="submit" class="btn btn-primary">
      {% translate 'Filter' %}
    </button>
  </form>
</div>

<!-- Media Grid -->
{% if media_files %}
<div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
  {% for file in media_files %}
  <div class="group relative bg-bg-secondary rounded-lg overflow-hidden hover:shadow-lg transition-shadow cursor-pointer">
    <a href="{% url 'dashboard:media:file_detail' file.pk %}" class="block">
      <!-- Thumbnail/Preview -->
      <div class="aspect-square bg-bg-tertiary flex items-center justify-center">
        {% if file.is_image %}
          <img 
            src="{{ file.get_thumbnail_url }}" 
            alt="{{ file.alt_text|default:file.title }}"
            class="w-full h-full object-cover"
            loading="lazy"
          >
        {% elif file.is_video %}
          <svg class="w-12 h-12 text-text-tertiary" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z" />
          </svg>
        {% elif file.is_document %}
          <svg class="w-12 h-12 text-text-tertiary" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
          </svg>
        {% else %}
          <svg class="w-12 h-12 text-text-tertiary" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" clip-rule="evenodd" />
          </svg>
        {% endif %}
      </div>
      
      <!-- File Info -->
      <div class="p-2">
        <p class="text-sm font-medium text-text-primary truncate" title="{{ file.title }}">
          {{ file.title|truncatechars:20 }}
        </p>
        <p class="text-xs text-text-tertiary">
          {{ file.file_size_mb }} MB
        </p>
      </div>
    </a>
    
    <!-- Quick Actions -->
    <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
      <a href="{% url 'dashboard:media:file_delete' file.pk %}" 
         class="bg-red-500 text-white p-1 rounded hover:bg-red-600"
         onclick="return confirm('{% translate "Are you sure you want to delete this file?" %}')">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
        </svg>
      </a>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Pagination -->
{% if is_paginated %}
<div class="flex justify-center items-center gap-2">
  {% if page_obj.has_previous %}
  <a href="?page=1{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}" 
     class="btn btn-secondary">
    {% translate 'First' %}
  </a>
  <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}" 
     class="btn btn-secondary">
    {% translate 'Previous' %}
  </a>
  {% endif %}
  
  <span class="text-text-secondary px-4">
    {% blocktranslate with current=page_obj.number total=page_obj.paginator.num_pages %}
    Page {{ current }} of {{ total }}
    {% endblocktranslate %}
  </span>
  
  {% if page_obj.has_next %}
  <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}" 
     class="btn btn-secondary">
    {% translate 'Next' %}
  </a>
  <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&q={{ search_query }}{% endif %}{% if current_type %}&type={{ current_type }}{% endif %}" 
     class="btn btn-secondary">
    {% translate 'Last' %}
  </a>
  {% endif %}
</div>
{% endif %}

{% else %}
<div class="text-center py-12">
  <svg class="w-16 h-16 mx-auto text-text-tertiary mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
  </svg>
  <p class="text-text-secondary text-lg mb-4">{% translate 'No files found' %}</p>
  <a href="{% url 'dashboard:media:upload' %}" class="btn btn-primary">
    {% translate 'Upload Your First File' %}
  </a>
</div>
{% endif %}
{% endblock %}
